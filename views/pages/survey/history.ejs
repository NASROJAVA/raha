<div class="mb-6">
  <h1 class="text-3xl font-bold text-gray-800 mb-2">سجل الاستبيانات</h1>
  <p class="text-gray-600">عرض سجل استبيانات الضغط السابقة ومتابعة تقدمك</p>
</div>

<!-- Stress Trend Chart -->
<div class="card mb-8">
  <div class="card-header">
    <h2 class="text-xl font-semibold text-gray-800">اتجاهات مستوى الضغط</h2>
  </div>
  
  <div class="card-body">
    <% if (stressTrends && stressTrends.length > 0) { %>
      <div class="h-64">
        <canvas id="stress-chart" data-chart-data="<%= JSON.stringify(stressTrends.map(trend => ({ survey_date: new Date(trend.survey_date).toLocaleDateString('ar-DZ'), average_stress: trend.average_stress }))) %>"></canvas>
      </div>
    <% } else { %>
      <div class="flex flex-col items-center justify-center py-8">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <p class="text-gray-600 mb-4">لم تقم بإجراء أي استبيانات بعد</p>
        <a href="/survey" class="btn-primary py-2 px-4 rounded-md">إجراء استبيان الآن</a>
      </div>
    <% } %>
  </div>
</div>

<!-- Survey History Table -->
<div class="card">
  <div class="card-header">
    <h2 class="text-xl font-semibold text-gray-800">سجل الاستبيانات السابقة</h2>
  </div>
  
  <div class="card-body">
    <% if (surveys && surveys.length > 0) { %>
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-right">
          <thead class="text-xs text-gray-700 uppercase bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3">التاريخ</th>
              <th scope="col" class="px-6 py-3">مستوى الضغط</th>
              <th scope="col" class="px-6 py-3">التصنيف</th>
              <th scope="col" class="px-6 py-3">الإجراءات</th>
            </tr>
          </thead>
          <tbody>
            <% surveys.forEach(survey => { 
              let stressClass = 'stress-level-low';
              let stressText = 'منخفض';
              
              if (survey.stress_level > 70) {
                stressClass = 'stress-level-high';
                stressText = 'مرتفع';
              } else if (survey.stress_level > 40) {
                stressClass = 'stress-level-medium';
                stressText = 'متوسط';
              }
            %>
              <tr class="bg-white border-b hover:bg-gray-50">
                <td class="px-6 py-4"><%= new Date(survey.completed_at).toLocaleString('ar-SA') %></td>
                <td class="px-6 py-4 font-medium <%= stressClass %>"><%= survey.stress_level %>%</td>
                <td class="px-6 py-4"><span class="<%= stressClass %>"><%= stressText %></span></td>
                <td class="px-6 py-4">
                  <a href="/survey/result/<%= survey.id %>" class="text-primary hover:text-primary-dark">عرض التفاصيل</a>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <div class="flex flex-col items-center justify-center py-8">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <p class="text-gray-600 mb-4">لم تقم بإجراء أي استبيانات بعد</p>
        <a href="/survey" class="btn-primary py-2 px-4 rounded-md">إجراء استبيان الآن</a>
      </div>
    <% } %>
  </div>
</div>

<div class="mt-6">
  <a href="/survey" class="btn-primary py-2 px-4 rounded-md">إجراء استبيان جديد</a>
</div>
